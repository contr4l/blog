---
title: 有好事，也有烦心事
date: 2024-05-30T02:23:00+0800
tags:
  - 碎碎念
---
这是`hugo`+`obsidian`写下的第一篇blog。

	技术选型不该是一件拍脑袋的事情

<!--more-->
<style> .summary-container { width: 60%; margin: 30px auto; padding: 20px; background-color: #f9f9f9; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); font-family: 'Arial', sans-serif; } .summary-title { font-size: 24px; color: #333; margin-bottom: 10px; } .summary-content { font-size: 16px; line-height: 1.6; color: #666; } .summary-highlight { color: #0056b3; font-weight: bold; } </style>
## AI总结
<div class="summary-content">
<p>FoxGlove可视化项目在过去半个月里遇到了一些挑战。最初，项目负责人低估了可视化的复杂性，认为它仅仅是将点、线、框等元素映射到可视化组件的简单工作。然而，在实际开发过程中，Lidar数据的可视化出现了性能问题，导致帧率远低于预期。团队最初将问题归咎于交换机，但后来发现数据回放时存在丢包现象，可能与开源DDS和交换机有关。</p>
<p>在开发支持L2周边的可视化方案时，尽管在Rviz2上已有完整的实现，但将现有代码迁移到FoxGlove上并非易事。在尝试将感知结果、模型和状态信息可视化时，遇到了模型和感知结果显示不稳定的问题，需要不断调整和调试。尽管遇到了数据同步问题，但通过重启有时可以解决问题。</p>
<p>尽管面临挑战，项目负责人计划继续推进项目，先实现所有能显示的功能，然后再解决性能和显示问题。此外，作者还分享了对一些电子产品的看法，如galaxy tab s9+和qe30，并对一些期待的游戏和娱乐活动感到失望。作者还提到了关于买房和结婚的个人生活规划。</p>
</div>

## 关于FoxGlove

最近的半个月算是在集中力量攻关L2算法在FoxGlove上可视化的事情。必须承认的一点是，我严重低估了这件事情的复杂程度——

> 可视化，不就是把点、线、框、文字、模型按照它们的位置、颜色、尺寸按照可视化组件支持的消息结构做好映射发出去就行了吗？

这是我最开始的想法。  
的确，从逻辑上来说，如果“一切组件都按照理想的情况工作”，可视化的确是一个不需要动太多脑子的苦力活，基于这个观点的Lidar/Radar甚至Camera+感知结果的可视化也早在近半年陆陆续续地实现了Demo。  

## 性能问题
问题最开始出现在Lidar的可视化上，理论上不超过每帧100K点数，峰值带宽不会超过100Mbps的数据，竟然在FoxGlove上出现了严重的卡顿，期望10帧的点云甚至不能做到稳定3帧运行，此时，我们对其的解释是：**垃圾交换机!**

紧接着，算法组提出了疑问：为什么数据回放时，在某些时间段内出现了严重的丢包情况？在数据热力图上可以看到，录制的消息并不均匀，并出现了大段空白。我们再次解释：**开源DDS+垃圾交换机导致的!**

在后来的后来，我们关注的感知方案都放在1V1R上，一路CompressedImage当然摸不到性能瓶颈。

> *但问题没解决，它就不会消失*
## 任务来临
> 我们终于决定基于FoxGlove开发一整套支持L2周边的可视化方案——在已经在Rviz2上有完整实现的情况下。

听起来不难，感知结果画三维框，模型复用ROS2的Marker，状态信息用框架提供的文本实现，好像一点一点搬就好了——甚至还有现成的大把代码可以CV。

> 给我半个月，我把ver0.1搬上来，我如是说。

## 消失的感知结果
> 融合感知结果...车道线绘制...    
> 很好...我们来对比一下前后的可视化效果。  
> ？！  
> 模型呢？？？  

——不出意外的话，应该是出意外了。  
最开始我看到3D Panel中空空如也时，心态是相当平和的：怎么可能一切都那么顺风顺水呢？

```
资源文件URL、平面需要做点旋转变换、背景色要稍微调一下、
有同名的package注意把预安装的卸载掉、模型的scale要做一些调整否则太大了...
```

虽然乱七八糟要调整不少东西，但确实是在成功的路上不断前进的。

......
```
很好，车模有了，车道线有了，感知结果也有了......  
？！  
怎么又没了？！
```
让我来发挥特长，调试调试吧...

	——同步可视化的两个框中，相同的数据源处于回灌状态，Rviz多显示出了额外的感知结果  
	——一定是哪里我写错的，一定是这样的  
	——那把数据信息也输出出来吧  
	——接收端物体数量是对的？！  
	——重启试试！  
	——果然好了！重启是最管用的！  
	——又消失了？  

是的，我发现了——  
在数据正确的情况下，他喵的3D框里常态性地没法把结果渲染出来!!!  
我他喵的是一万五的工作站啊!!!  
我他喵的上面还有一张T600啊!!!  
这他妈怎么玩？从基于平台开发可视化业务代码变成优化平台性能？这是我这个年纪应该承受的？  

## 接下来的打算
先不管它性能怎么样，也不管它到底显示不显示全，先把所有能显示的东西堆上去吧。  
垃圾厨子把菜炒翻锅了，也不影响把它盛进盘子里。  

> 但真是翻了个大车，职业生涯之殇了属于是。

## 好事？碎碎念
1. galaxy tab s9+还不错，笔触秒杀apple pencil pro
2. 899买的爱国想的qe30也不错，家用这方面，高刷带来的体验提升的确要好过4k
3. 游戏短期内是真的打不太动了，遥遥无期的428，遥遥无期的博3，遥遥无期的卧龙
4. 关于买房、结婚也许过几天新开一篇博写一写吧。